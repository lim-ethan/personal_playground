# 버킷 구성

### aws-athena-query-results-ap-northeast-2-484907520317
- Athena Query 및 조회 결과

### aws-glue-assets-484907520317-ap-northeast-2
- Glue에서 사용한 ETL Pipeline 정보 및 Script

### datalab-public-bucket
- 실제 데이터 업로드 및 Glue ETL Job Metadata 정보 저장

### lamb-eve-log
- Lambda Event Log 기록



# datalab-public-bucket 버킷더 구성

### checkpoint/ (init test)
- kinesis 데이터를 일반 Parquet File 형태로 Stream때 사용되었던 Checkpoint 

### dummy_data/ (init test)
- JSON 파일 더미 데이터 테스트 (glue crawling)

### iceberg_stream_test_checkpoint/
- kinesis 데이터를 Iceberg Format으로 Stream하였을 때 사용되었던 Checkpoint

### jars/
- Glue Spark에서 사용할 package 관련 jar 파일 모음

### lambda/
- csv 데이터 업로드 path

### parquet/ (init test)
- kinesis 데이터 스트림 후 일반 Parquet Format장

### warehoue
- Spark을 이용하여 카탈로그 기반 테이블 포맷 (hive, delta, iceberg) 사용 시 데이터 파일이 저장될 기본 경로 지정하는 역할

<p align="center">
  <img src="./Images/02. S3 policy.png" width="600"/>
</p>

# 역할 및 정책

## 역할명
- **glue_kinesis_s3_role**

---

## 권한 정책

### AWS 관리형 정책
- `AmazonKinesisAnalyticsReadOnly`
- `AmazonS3FullAccess`
- `CloudWatchLogsFullAccess`

### 고객 관리형 정책
- `code_whisper`
- `glue_iceberg_table`
- `glue_kinesis_s3_policy` *(AWS 관리형 정책과 동일한 내용 존재)*
- `gluePassRole`

# 각 정책별 JSON
### [code_whisper]
```json
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "Statement1",
			"Effect": "Allow",
			"Action": [
				"codewhisperer:GenerateRecommendations"
			],
			"Resource": "*"
		}
	]
}
```

### [glue_iceberg_table]
```json
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "Statement1",
			"Effect": "Allow",
			"Action": [
				"glue:GetDatabase",
				"glue:GetDatabases",
				"glue:GetTable",
				"glue:GetTables",
				"glue:CreateTable",
				"glue:UpdateTable",
				"glue:DeleteTable"
			],
			"Resource": [
				"arn:aws:glue:ap-northeast-2:{accountid}:catalog",
				"arn:aws:glue:ap-northeast-2:{accountid}:database/*",
				"arn:aws:glue:ap-northeast-2:{accountid}:table/*/*"
			]
		}
	]
}
```

[gluePassRole]
```json
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Effect": "Allow",
			"Action": "iam:PassRole",
			"Resource": "arn:aws:iam::{accountid}:role/glue_kinesis_s3_role"
		},
		{
			"Effect": "Allow",
			"Action": [
				"glue:CreateSession",
				"glue:GetSession",
				"glue:StopSession",
				"glue:RunStatement",
				"glue:GetStatement",
				"glue:ListSessions",
				"glue:ListStatements",
				"glue:TagResource"
			],
			"Resource": "arn:aws:glue:ap-northeast-2:{accountid}:session/*"
		}
	]
}
```